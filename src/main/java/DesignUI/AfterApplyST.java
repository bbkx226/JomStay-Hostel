package DesignUI;

import Models.Application;
import Models.Room;
import Utils.ApplicationHandling;
import Utils.Config;
import Utils.PopUpWindow;
import Utils.RoomHandling;
import java.awt.Color;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;

/**
 *
 * @author KZ
 */
public class AfterApplyST extends javax.swing.JPanel {

    private static Application currentApplication;
    private static Room room;
    private static DateTimeFormatter createDateFormatter;
    private static DateTimeFormatter dateFormatter;
    
    /**
     * Creates new form AfterApplyST
     */
    public AfterApplyST() {
        initData();
        initComponents();
    }
    
    // initialize data to show in GUI
    private static void initData() {
        currentApplication = HostelST.getCurrentUserApplication();
        room = HostelST.getCurrentUserRoom();
        createDateFormatter = Config.dateFormats.DISPLAY_APPLICATION_CREATE_DATE.getFormatter();
        dateFormatter = Config.dateFormats.DISPLAY_APPLICATION_START_END_DATE.getFormatter();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        appliedPanel = new javax.swing.JPanel();
        jLabel53 = new javax.swing.JLabel();
        statusLabel = new javax.swing.JLabel();
        jLabel61 = new javax.swing.JLabel();
        applicationDateLabel = new javax.swing.JLabel();
        jLabel59 = new javax.swing.JLabel();
        checkInDateLabel = new javax.swing.JLabel();
        jLabel60 = new javax.swing.JLabel();
        checkOutDateLabel = new javax.swing.JLabel();
        jLabel52 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel54 = new javax.swing.JLabel();
        roomNumLabel = new javax.swing.JLabel();
        jLabel55 = new javax.swing.JLabel();
        roomTypeLabel = new javax.swing.JLabel();
        jLabel56 = new javax.swing.JLabel();
        roomTypeLabel1 = new javax.swing.JLabel();
        roomIcon = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        cancelApplicationBtn = new javax.swing.JButton();

        setBackground(new java.awt.Color(255, 255, 255));

        appliedPanel.setBackground(new java.awt.Color(255, 255, 255));
        appliedPanel.setLayout(new java.awt.GridLayout(8, 2, 0, 30));

        jLabel53.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel53.setForeground(new java.awt.Color(51, 51, 51));
        jLabel53.setText("Status");
        appliedPanel.add(jLabel53);

        statusLabel.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        statusLabel.setForeground(new java.awt.Color(0, 0, 0));
        statusLabel.setText(currentApplication.getStatus());
        switch (statusLabel.getText()) {
            case "Pending" ->
            statusLabel.setForeground(Color.BLUE);
            case "Rejected" ->
            statusLabel.setForeground(Color.RED);
            case "Accepted" ->
            statusLabel.setForeground(Color.GREEN);
            default ->
            statusLabel.setForeground(Color.BLACK);
        }
        appliedPanel.add(statusLabel);

        jLabel61.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel61.setForeground(new java.awt.Color(51, 51, 51));
        jLabel61.setText("Application Date");
        appliedPanel.add(jLabel61);

        applicationDateLabel.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        applicationDateLabel.setForeground(new java.awt.Color(0, 0, 0));
        applicationDateLabel.setText(currentApplication.getLocalCreateDate().format(createDateFormatter));
        appliedPanel.add(applicationDateLabel);

        jLabel59.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel59.setForeground(new java.awt.Color(51, 51, 51));
        jLabel59.setText("Check-In Date");
        appliedPanel.add(jLabel59);

        checkInDateLabel.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        checkInDateLabel.setForeground(new java.awt.Color(0, 0, 0));
        checkInDateLabel.setText(currentApplication.getLocalStartDate().format(dateFormatter));
        appliedPanel.add(checkInDateLabel);

        jLabel60.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel60.setForeground(new java.awt.Color(51, 51, 51));
        jLabel60.setText("Check-Out Date");
        appliedPanel.add(jLabel60);

        checkOutDateLabel.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        checkOutDateLabel.setForeground(new java.awt.Color(0, 0, 0));
        checkOutDateLabel.setText(currentApplication.getLocalEndDate().format(dateFormatter));
        appliedPanel.add(checkOutDateLabel);

        jLabel52.setFont(new java.awt.Font("Arial", 1, 36)); // NOI18N
        jLabel52.setForeground(new java.awt.Color(51, 51, 51));
        jLabel52.setText("Room Details");
        appliedPanel.add(jLabel52);

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 383, Short.MAX_VALUE)
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 30, Short.MAX_VALUE)
        );

        appliedPanel.add(jPanel1);

        jLabel54.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel54.setForeground(new java.awt.Color(51, 51, 51));
        jLabel54.setText("Room Number");
        appliedPanel.add(jLabel54);

        roomNumLabel.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        roomNumLabel.setForeground(new java.awt.Color(0, 0, 0));
        roomNumLabel.setText(room.getRoomID());
        appliedPanel.add(roomNumLabel);

        jLabel55.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel55.setForeground(new java.awt.Color(51, 51, 51));
        jLabel55.setText("Room Type");
        appliedPanel.add(jLabel55);

        roomTypeLabel.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        roomTypeLabel.setForeground(new java.awt.Color(0, 0, 0));
        roomTypeLabel.setText(room.getRoomType().getTypeName());
        appliedPanel.add(roomTypeLabel);

        jLabel56.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel56.setForeground(new java.awt.Color(51, 51, 51));
        jLabel56.setText("Floor");
        appliedPanel.add(jLabel56);

        roomTypeLabel1.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        roomTypeLabel1.setForeground(new java.awt.Color(0, 0, 0));
        roomTypeLabel1.setText(RoomHandling.getRoomFloor(room));
        appliedPanel.add(roomTypeLabel1);

        roomIcon.setIcon(new javax.swing.ImageIcon(getClass().getResource("/assets/dorm_room_pic_small.png"))); // NOI18N
        roomIcon.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        roomIcon.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        roomIcon.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                roomIconsingleRoomClicked(evt);
            }
        });

        jLabel1.setBackground(new java.awt.Color(255, 255, 255));
        jLabel1.setFont(new java.awt.Font("Arial", 0, 12)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(0, 0, 0));
        jLabel1.setText("Click on the picture for more details");

        cancelApplicationBtn.setBackground(new java.awt.Color(0, 0, 0));
        cancelApplicationBtn.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        cancelApplicationBtn.setForeground(new java.awt.Color(255, 255, 255));
        cancelApplicationBtn.setText("Cancel Application");
        cancelApplicationBtn.setToolTipText(null);
        cancelApplicationBtn.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        cancelApplicationBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelApplicationBtnActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap(808, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(roomIcon)
                                .addGap(10, 10, 10)))
                        .addGap(39, 39, 39))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(cancelApplicationBtn, javax.swing.GroupLayout.PREFERRED_SIZE, 226, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addContainerGap())))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(appliedPanel, javax.swing.GroupLayout.PREFERRED_SIZE, 766, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(268, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(67, 67, 67)
                .addComponent(cancelApplicationBtn)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 171, Short.MAX_VALUE)
                .addComponent(roomIcon)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel1)
                .addContainerGap())
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(appliedPanel, javax.swing.GroupLayout.PREFERRED_SIZE, 450, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );

        if (currentApplication.getStatus().equals("Pending")) {
            cancelApplicationBtn.setVisible(true);
        } else {
            cancelApplicationBtn.setVisible(false);
        }
    }// </editor-fold>//GEN-END:initComponents

    private void roomIconsingleRoomClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_roomIconsingleRoomClicked
        // TODO add your handling code here:
        PopUpWindow.showRoom(HostelST.getCurrentUserRoom().getRoomType().toString(), "Room Details", "OK");
    }//GEN-LAST:event_roomIconsingleRoomClicked

    // remove the application from the text file if cancel button is pressed
    private void cancelApplicationBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelApplicationBtnActionPerformed
        boolean cancel = PopUpWindow.showConfirmMessage("Cancel application?", "Cancellation");
        if (cancel) {
            ArrayList<Application> applications = ApplicationHandling.getTotalApplications();
            int i = 0;
            for (Application application : applications) {
                if (application.equals(currentApplication)) {
                    i = applications.indexOf(application);
                    application.getRoom().setStatus("Available");
                    RoomHandling.updateRoomInFile(application.getRoom());
                    break;
                }
            }
            applications.remove(i);
            ApplicationHandling.updateApplicationFile(applications);
            
            PopUpWindow.showSuccessfulMessage("Application cancelled.", "Cancellation");
            Login.getHostelFrame().dispose();
            HostelST hostelST = new HostelST();
            HostelST.setSelectedRoom(null);
            Login.setHostelFrame(hostelST);
        }
    }//GEN-LAST:event_cancelApplicationBtnActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private static javax.swing.JLabel applicationDateLabel;
    private javax.swing.JPanel appliedPanel;
    private static javax.swing.JButton cancelApplicationBtn;
    private static javax.swing.JLabel checkInDateLabel;
    private static javax.swing.JLabel checkOutDateLabel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel52;
    private javax.swing.JLabel jLabel53;
    private javax.swing.JLabel jLabel54;
    private javax.swing.JLabel jLabel55;
    private javax.swing.JLabel jLabel56;
    private javax.swing.JLabel jLabel59;
    private javax.swing.JLabel jLabel60;
    private javax.swing.JLabel jLabel61;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JLabel roomIcon;
    private static javax.swing.JLabel roomNumLabel;
    private static javax.swing.JLabel roomTypeLabel;
    private static javax.swing.JLabel roomTypeLabel1;
    private static javax.swing.JLabel statusLabel;
    // End of variables declaration//GEN-END:variables
}
